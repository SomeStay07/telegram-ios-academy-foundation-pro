<!doctype html>
<html lang='ru'>
<head>
  <meta charset='UTF-8'/>
  
  <!-- Comprehensive Viewport Configuration -->
  <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=5.0, minimum-scale=0.5, user-scalable=yes, viewport-fit=cover'/>
  
  <!-- PWA Meta Tags -->
  <meta name='mobile-web-app-capable' content='yes'/>
  <meta name='apple-mobile-web-app-capable' content='yes'/>
  <meta name='apple-mobile-web-app-status-bar-style' content='black-translucent'/>
  <meta name='theme-color' content='#000000'/>
  <meta name='msapplication-navbutton-color' content='#000000'/>
  
  <!-- Telegram WebApp Meta -->
  <meta name='telegram-web-app' content='1'/>
  
  <!-- Telegram WebApp Script - CRITICAL for WebApp API -->
  <script 
    src="https://telegram.org/js/telegram-web-app.js"
    onload="console.log('‚úÖ Telegram script loaded successfully')"
    onerror="console.error('‚ùå Failed to load Telegram script from telegram.org')"
    crossorigin="anonymous"
  ></script>
  
  <!-- Emergency Telegram WebApp Diagnostics -->
  <script>
    // EMERGENCY DEBUG: Show all Telegram data immediately
    function emergencyTelegramDiagnostics() {
      console.log('üö® EMERGENCY TELEGRAM DIAGNOSTICS üö®')
      console.log('URL:', window.location.href)
      console.log('User Agent:', navigator.userAgent)
      console.log('Referrer:', document.referrer)
      
      // Check if Telegram object exists
      if (window.Telegram) {
        console.log('‚úÖ window.Telegram EXISTS')
        
        if (window.Telegram.WebApp) {
          const webApp = window.Telegram.WebApp
          console.log('‚úÖ window.Telegram.WebApp EXISTS')
          
          // Log ALL WebApp properties
          console.log('üì± FULL WebApp Object:', webApp)
          console.log('üì± WebApp Keys:', Object.keys(webApp))
          
          // Specific critical properties
          console.log('üîë CRITICAL DATA:')
          console.log('  - initData:', webApp.initData)
          console.log('  - initData length:', webApp.initData?.length || 0)
          console.log('  - initDataUnsafe:', webApp.initDataUnsafe)
          console.log('  - user:', webApp.initDataUnsafe?.user)
          console.log('  - platform:', webApp.platform)
          console.log('  - version:', webApp.version)
          console.log('  - isExpanded:', webApp.isExpanded)
          
          if (webApp.initDataUnsafe?.user) {
            console.log('üë§ USER DATA FOUND:', webApp.initDataUnsafe.user)
          } else {
            console.log('‚ùå NO USER DATA IN initDataUnsafe')
          }
          
          // Try to initialize
          try {
            webApp.ready()
            webApp.expand()
            console.log('‚úÖ WebApp initialized successfully')
          } catch (error) {
            console.error('‚ùå WebApp initialization failed:', error)
          }
          
        } else {
          console.log('‚ùå window.Telegram.WebApp MISSING')
        }
      } else {
        console.log('‚ùå window.Telegram MISSING - NOT IN TELEGRAM')
      }
      
      // Check query parameters for debug
      const urlParams = new URLSearchParams(window.location.search)
      console.log('üîç URL Parameters:', Object.fromEntries(urlParams))
    }
    
    // Run diagnostics immediately
    emergencyTelegramDiagnostics()
    
    // Run again after script loads
    setTimeout(emergencyTelegramDiagnostics, 500)
    setTimeout(emergencyTelegramDiagnostics, 1000)
    setTimeout(emergencyTelegramDiagnostics, 2000)
    
    // Also on DOMContentLoaded
    document.addEventListener('DOMContentLoaded', emergencyTelegramDiagnostics)
  </script>
  
  <title>iOS Academy Pro</title>
  <style>
    /* Telegram theme defaults for local development */
    :root {
      --tg-theme-bg-color: #0b0d10;
      --tg-theme-text-color: #e6e7e9;
      --tg-theme-button-color: #3b82f6;
      --tg-theme-button-text-color: #ffffff;
      --tg-theme-link-color: #60a5fa;
      --tg-color-scheme: dark;
      
      /* Design system fallbacks */
      --background: var(--tg-theme-bg-color);
      --foreground: var(--tg-theme-text-color);
      --primary: var(--tg-theme-button-color);
      --accent: var(--tg-theme-link-color);
    }
    
    /* Prevent white flash by applying Telegram theme immediately */
    html { 
      background: var(--tg-theme-bg-color, #000); 
      color-scheme: var(--tg-color-scheme, dark); 
    }
    body { 
      background: inherit; 
      margin: 0;
    }
  </style>
</head>
<body>
  <div id='root'></div>
  <script type='module' src='/src/main.tsx'></script>
</body>
</html>
