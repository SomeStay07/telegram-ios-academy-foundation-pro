@tailwind base;
@tailwind components;
@tailwind utilities;

/* Telegram WebApp safe area and viewport */
:root {
  --tg-vph: 100vh; /* Telegram viewport stable height */
  --tg-safe-area-inset-bottom: env(safe-area-inset-bottom, 0px);
}

/* Telegram WebApp theme integration with shadcn/ui tokens */
:root {
  /* Map Telegram CSS vars to shadcn tokens */
  --background: var(--tg-theme-bg-color, hsl(0 0% 100%));
  --foreground: var(--tg-theme-text-color, hsl(0 0% 10%));

  --card: var(--tg-theme-secondary-bg-color, hsl(0 0% 100%));
  --card-foreground: var(--tg-theme-text-color, hsl(0 0% 10%));

  --muted: var(--tg-theme-secondary-bg-color, hsl(0 0% 96%));
  --muted-foreground: var(--tg-theme-hint-color, hsl(0 0% 45%));

  --border: color-mix(in oklab, var(--foreground) 12%, var(--background));
  --primary: var(--tg-theme-button-color, hsl(222 47% 50%));
  --primary-foreground: var(--tg-theme-button-text-color, hsl(0 0% 100%));

  /* Additional shadcn tokens */
  --popover: var(--card);
  --popover-foreground: var(--card-foreground);
  --secondary: var(--muted);
  --secondary-foreground: var(--muted-foreground);
  --accent: var(--muted);
  --accent-foreground: var(--muted-foreground);
  --destructive: hsl(0 84% 60%);
  --destructive-foreground: hsl(0 0% 98%);
  --ring: var(--primary);
  --radius: 0.5rem;

  color-scheme: var(--tg-color-scheme, light);
  background: var(--background);
  color: var(--foreground);
}

.dark {
  --background: var(--tg-theme-bg-color, hsl(0 0% 13%));
  --foreground: var(--tg-theme-text-color, hsl(0 0% 95%));

  --card: var(--tg-theme-secondary-bg-color, hsl(0 0% 17%));
  --card-foreground: var(--tg-theme-text-color, hsl(0 0% 95%));

  --muted: var(--tg-theme-secondary-bg-color, hsl(0 0% 15%));
  --muted-foreground: var(--tg-theme-hint-color, hsl(0 0% 63%));

  --border: color-mix(in oklab, var(--foreground) 15%, var(--background));
  --primary: var(--tg-theme-button-color, hsl(210 90% 70%));
  --primary-foreground: var(--tg-theme-button-text-color, hsl(0 0% 100%));

  --popover: var(--card);
  --popover-foreground: var(--card-foreground);
  --secondary: var(--muted);
  --secondary-foreground: var(--muted-foreground);
  --accent: var(--muted);
  --accent-foreground: var(--muted-foreground);
  --destructive: hsl(0 63% 31%);
  --destructive-foreground: hsl(0 0% 98%);
  --ring: var(--primary);

  color-scheme: var(--tg-color-scheme, dark);
}

/* Apply Telegram theme colors to body */
body {
  background: var(--background);
  color: var(--foreground);
  transition: background-color 0.2s ease, color 0.2s ease;
}

/* Link color from Telegram */
a {
  color: var(--tg-theme-link-color, hsl(215 90% 56%));
}

/* Safe area utilities */
.safe-bottom {
  padding-bottom: calc(env(safe-area-inset-bottom, 0px) + 0.5rem);
}

.safe-top {
  padding-top: calc(env(safe-area-inset-top, 0px) + 0.5rem);
}

/* Viewport height using Telegram stable height */
.h-screen-tg {
  height: var(--tg-vph);
}

.min-h-screen-tg {
  min-height: var(--tg-vph);
}

/* Profile Stats Breathing Border Animation */
@keyframes border-breathing-calm {
  0%, 100% {
    border-color: rgba(100, 116, 139, 0.25);
    box-shadow: 0 0 0 0 rgba(100, 116, 139, 0.1);
  }
  50% {
    border-color: rgba(100, 116, 139, 0.45);
    box-shadow: 0 0 0 4px rgba(100, 116, 139, 0.05);
  }
}

/* === MODERN RESPONSIVE DESIGN SYSTEM === */

/* Design Tokens with Clamp Functions */
@layer base {
  :root {
    /* Fluid Typography Scale */
    --text-xs: clamp(0.7rem, 1.5vw + 0.5rem, 0.75rem);
    --text-sm: clamp(0.8rem, 2vw + 0.5rem, 0.875rem);
    --text-base: clamp(0.9rem, 2.5vw + 0.5rem, 1rem);
    --text-lg: clamp(1rem, 3vw + 0.5rem, 1.125rem);
    --text-xl: clamp(1.1rem, 3.5vw + 0.5rem, 1.25rem);
    --text-2xl: clamp(1.25rem, 4vw + 0.5rem, 1.5rem);
    --text-3xl: clamp(1.5rem, 5vw + 0.5rem, 1.875rem);
    --text-4xl: clamp(1.75rem, 6vw + 0.5rem, 2.25rem);
    --text-5xl: clamp(2rem, 8vw + 0.5rem, 3rem);
    
    /* Gaming-specific typography */
    --text-gaming-number: clamp(1.25rem, 4vw + 0.5rem, 2rem);
    --text-gaming-level: clamp(0.9rem, 3vw + 0.5rem, 1.1rem);
    --text-gaming-xp: clamp(0.8rem, 2.5vw + 0.5rem, 1rem);
    --text-gaming-username: clamp(0.75rem, 2.5vw + 0.5rem, 0.9rem);
    
    /* Container Query Typography (cqw = container query width) */
    --text-container-xs: clamp(0.7rem, 2cqw, 0.75rem);
    --text-container-sm: clamp(0.8rem, 2.5cqw, 0.875rem);
    --text-container-base: clamp(0.9rem, 3cqw, 1rem);
    --text-container-lg: clamp(1rem, 3.5cqw, 1.125rem);
    --text-container-xl: clamp(1.1rem, 4cqw, 1.25rem);
    
    /* Fluid spacing system */
    --space-fluid-xs: clamp(0.25rem, 1vw, 0.5rem);
    --space-fluid-sm: clamp(0.5rem, 2vw, 0.75rem);
    --space-fluid-md: clamp(0.75rem, 3vw, 1rem);
    --space-fluid-lg: clamp(1rem, 4vw, 1.5rem);
    --space-fluid-xl: clamp(1.5rem, 5vw, 2rem);
    --space-fluid-2xl: clamp(2rem, 6vw, 3rem);
    
    /* Container-based spacing */
    --space-container-xs: clamp(0.25rem, 1cqw, 0.5rem);
    --space-container-sm: clamp(0.5rem, 2cqw, 0.75rem);
    --space-container-md: clamp(0.75rem, 3cqw, 1rem);
    --space-container-lg: clamp(1rem, 4cqw, 1.5rem);
    --space-container-xl: clamp(1.5rem, 5cqw, 2rem);
  }
}

/* === PROFILE-SPECIFIC TYPOGRAPHY === */
@layer components {
  /* Profile Name - Hero Typography */
  .profile-name-clean {
    font-size: var(--text-4xl);
    font-weight: 700;
    line-height: 1.1;
    letter-spacing: -0.02em;
    margin: 0;
    margin-bottom: var(--space-fluid-sm);
  }

  .name-text {
    display: inline-block;
    background: linear-gradient(135deg, #ffffff 0%, #e5e7eb 100%);
    background-clip: text;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  /* Username Badge Typography */
  .username-badge-modern {
    font-size: var(--text-gaming-username);
    font-weight: 500;
    line-height: 1;
    padding: var(--space-container-xs) var(--space-container-sm);
    border-radius: clamp(0.5rem, 1.5cqw, 0.75rem);
    margin: var(--space-container-xs);
  }

  .username-at-symbol {
    font-size: 1.1em;
    font-weight: 600;
    opacity: 0.8;
  }

  .username-text {
    font-variant-numeric: tabular-nums;
    white-space: nowrap;
  }

  /* Level Badge Typography */
  .level-number-inside {
    font-size: clamp(0.7rem, 3cqw, 0.9rem);
    font-weight: 800;
    font-variant-numeric: tabular-nums;
    line-height: 1;
    color: white;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
  }

  /* === PROGRESS BAR RESPONSIVE === */
  
  /* Progress Container */
  .progress-container-enhanced {
    container-type: inline-size;
    width: 100%;
    position: relative;
    
    /* Fluid margins and padding */
    margin: var(--space-fluid-md) 0;
    padding: var(--space-container-sm);
  }
  
  /* Progress Bar Dynamic */
  .progress-bar-dynamic {
    width: 100%;
    height: clamp(8px, 2cqw, 16px);
    background: rgba(255, 255, 255, 0.1);
    border-radius: clamp(4px, 1cqw, 8px);
    position: relative;
    overflow: hidden;
    
    /* Enhanced visual feedback */
    border: 1px solid rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(4px);
  }
  
  /* Progress Tooltip Container */
  .progress-tooltip-container {
    position: absolute;
    z-index: 100;
    transform: translateX(-50%);
    display: flex;
    flex-direction: column;
    align-items: center;
    pointer-events: none;
  }
  
  /* Progress Arrow - Modern Design */
  .progress-arrow {
    width: 0;
    height: 0;
    border-left: clamp(6px, 1.5cqw, 10px) solid transparent;
    border-right: clamp(6px, 1.5cqw, 10px) solid transparent;
    border-bottom: clamp(8px, 2cqw, 12px) solid rgba(255, 255, 255, 0.2);
    margin-bottom: 2px;
    
    /* Enhanced arrow styling */
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
    position: relative;
    
    /* Animation for high progress */
    transition: all 0.3s ease;
  }
  
  /* Arrow glow effect for high progress */
  .progress-tooltip-container[style*="85%"] .progress-arrow,
  .progress-tooltip-container[style*="9"] .progress-arrow {
    border-bottom-color: rgba(16, 185, 129, 0.4);
    filter: 
      drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3))
      drop-shadow(0 0 8px rgba(16, 185, 129, 0.3));
  }

  /* Progress Percentage Badge - Modern Responsive */
  .progress-percentage-badge {
    position: relative;
    pointer-events: auto;
    
    /* Fluid sizing */
    padding: var(--space-container-xs) var(--space-container-sm);
    border-radius: clamp(0.5rem, 1.5cqw, 0.75rem);
    
    /* Modern typography */
    font-size: clamp(0.7rem, 2.5cqw, 0.85rem);
    font-weight: 700;
    font-variant-numeric: tabular-nums;
    line-height: 1;
    
    /* Glass morphism effect */
    background: linear-gradient(135deg, 
      rgba(255, 255, 255, 0.2) 0%,
      rgba(255, 255, 255, 0.1) 100%
    );
    border: 1px solid rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(12px);
    box-shadow: 
      0 4px 12px rgba(0, 0, 0, 0.3),
      inset 0 1px 0 rgba(255, 255, 255, 0.2);
      
    /* Color and text */
    color: white;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
    white-space: nowrap;
    user-select: none;
    cursor: pointer;
    
    /* Smooth interactions */
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    
    /* Prevent text selection */
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
  }
  
  /* Container Query Adjustments for Progress Tooltip */
  @container (min-width: 400px) {
    .progress-tooltip-container {
      bottom: clamp(-45px, -12cqw, -50px);
    }
    
    .progress-arrow {
      border-left-width: clamp(8px, 2cqw, 12px);
      border-right-width: clamp(8px, 2cqw, 12px);
      border-bottom-width: clamp(10px, 2.5cqw, 14px);
      margin-bottom: 3px;
    }
    
    .progress-percentage-badge {
      padding: var(--space-container-sm) var(--space-container-md);
      font-size: clamp(0.8rem, 3cqw, 0.95rem);
      border-radius: clamp(0.75rem, 2cqw, 1rem);
    }
  }
  
  @container (min-width: 600px) {
    .progress-tooltip-container {
      bottom: clamp(-55px, -15cqw, -60px);
    }
    
    .progress-arrow {
      border-left-width: clamp(10px, 2.5cqw, 14px);
      border-right-width: clamp(10px, 2.5cqw, 14px);
      border-bottom-width: clamp(12px, 3cqw, 16px);
      margin-bottom: 4px;
    }
    
    .progress-percentage-badge {
      padding: var(--space-container-md) var(--space-container-lg);
      font-size: clamp(0.85rem, 3.5cqw, 1rem);
    }
    
    .progress-bar-dynamic {
      height: clamp(12px, 3cqw, 20px);
      border-radius: clamp(6px, 1.5cqw, 10px);
    }
  }
  
  /* Position tooltip below progress bar */
  .progress-tooltip-container {
    bottom: clamp(-40px, -10cqw, -45px);
  }
  
  /* Progress Fill Dynamic */
  .progress-fill-dynamic {
    height: 100%;
    border-radius: inherit;
    position: relative;
    overflow: hidden;
    
    /* Enhanced glow effect */
    filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.3));
  }
  
  /* Progress Glow Dynamic */
  .progress-glow-dynamic {
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    border-radius: inherit;
    z-index: -1;
    pointer-events: none;
  }
  
  /* High Progress State */
  .progress-bar-dynamic.near-complete {
    animation: progress-pulse 2s ease-in-out infinite;
  }
  
  @keyframes progress-pulse {
    0%, 100% {
      box-shadow: 0 0 10px rgba(255, 255, 255, 0.2);
    }
    50% {
      box-shadow: 0 0 20px rgba(255, 255, 255, 0.4);
    }
  }
  
  /* Progress Sparkles Animation */
  .progress-percentage-badge .absolute {
    font-size: clamp(0.6rem, 2cqw, 0.75rem);
  }
  
  /* Enhanced hover states */
  .progress-percentage-badge:hover {
    background: linear-gradient(135deg, 
      rgba(255, 255, 255, 0.3) 0%,
      rgba(255, 255, 255, 0.15) 100%
    );
    border-color: rgba(255, 255, 255, 0.3);
    box-shadow: 
      0 6px 20px rgba(0, 0, 0, 0.4),
      inset 0 1px 0 rgba(255, 255, 255, 0.3);
    text-shadow: 0 0 8px rgba(255, 255, 255, 0.8);
  }
  
  /* Max rank styling */
  .progress-bar-dynamic.max-rank .progress-percentage-badge {
    background: linear-gradient(135deg, 
      rgba(255, 215, 0, 0.3) 0%,
      rgba(255, 215, 0, 0.15) 100%
    );
    border-color: rgba(255, 215, 0, 0.4);
    color: #ffd700;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.7);
  }
  
  /* Special effects for high progress */
  .progress-percentage-badge[style*="left: 85"],
  .progress-percentage-badge[style*="left: 9"] {
    animation: high-progress-glow 3s ease-in-out infinite;
  }
  
  @keyframes high-progress-glow {
    0%, 100% {
      box-shadow: 
        0 4px 12px rgba(0, 0, 0, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.2),
        0 0 15px rgba(16, 185, 129, 0.3);
    }
    50% {
      box-shadow: 
        0 6px 20px rgba(0, 0, 0, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.3),
        0 0 25px rgba(16, 185, 129, 0.6);
    }
  }
  
  /* Enhanced sparkles for mobile */
  @container (max-width: 400px) {
    .progress-percentage-badge .absolute {
      font-size: clamp(0.5rem, 3vw, 0.65rem);
      top: clamp(-12px, -3vw, -8px) !important;
      left: clamp(-8px, -2vw, -6px) !important;
      right: clamp(-8px, -2vw, -6px) !important;
    }
  }
  
  /* Premium glow effect for nearly complete progress */
  .progress-bar-dynamic.near-complete .progress-percentage-badge {
    background: linear-gradient(135deg, 
      rgba(16, 185, 129, 0.3) 0%,
      rgba(16, 185, 129, 0.15) 100%
    );
    border-color: rgba(16, 185, 129, 0.4);
    color: #10b981;
    text-shadow: 0 0 8px rgba(16, 185, 129, 0.8);
  }
  
  /* Arrow animation for high progress */
  .progress-bar-dynamic.near-complete .progress-arrow {
    border-bottom-color: rgba(16, 185, 129, 0.5);
    animation: arrow-pulse 2s ease-in-out infinite;
  }
  
  @keyframes arrow-pulse {
    0%, 100% {
      filter: 
        drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3))
        drop-shadow(0 0 8px rgba(16, 185, 129, 0.3));
    }
    50% {
      filter: 
        drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3))
        drop-shadow(0 0 15px rgba(16, 185, 129, 0.6));
    }
  }
  
  /* Hover effects for tooltip */
  .progress-tooltip-container:hover .progress-arrow {
    border-bottom-color: rgba(255, 255, 255, 0.4);
    filter: 
      drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3))
      drop-shadow(0 0 10px rgba(255, 255, 255, 0.3));
  }
  
  /* Bounce animation on appear */
  .progress-tooltip-container {
    animation: tooltip-appear 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
  }
  
  @keyframes tooltip-appear {
    0% {
      opacity: 0;
      transform: translateX(-50%) translateY(20px) scale(0.8);
    }
    60% {
      transform: translateX(-50%) translateY(-5px) scale(1.05);
    }
    100% {
      opacity: 1;
      transform: translateX(-50%) translateY(0) scale(1);
    }
  }
  
  /* Focus states for accessibility */
  .progress-percentage-badge:focus {
    outline: 2px solid rgba(255, 255, 255, 0.8);
    outline-offset: 2px;
    border-radius: clamp(0.5rem, 1.5cqw, 0.75rem);
  }
  
  /* Performance optimization */
  .progress-percentage-badge {
    will-change: transform, opacity;
    contain: layout style paint;
  }
  
  /* Clean up will-change after animation completes */
  .progress-percentage-badge:not(:hover):not(:focus) {
    will-change: auto;
  }
  
  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    .progress-percentage-badge {
      transition: none;
      animation: none !important;
    }
    
    .progress-bar-dynamic.near-complete {
      animation: none;
    }
    
    .progress-percentage-badge .absolute {
      animation: none !important;
    }
  }
}
